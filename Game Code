# The script of the game goes in this file.

define d = Character("Doug")
define s = Character('Soyan')
define do = Character('Dr. OX')
define p = Character('Patch')

#########################################
#FUNCTION
#########################################

#"Function"/pseudo-function
#calls the qte screen
#parameters are:
#    - amount of time given
#    - total amount of time (is usually the same as above)
#    - timer decreasing interval
#    - the key/keyboard input to hit in the quick time event
#   - the x alignment of the bar/box
#    - the y alignment of the bar/box
label qte_setup(time_start, time_max, interval, trigger_key, x_align, y_align):

    $ time_start = time_start
    $ time_max = time_max
    $ interval = interval
    $ trigger_key = trigger_key
    $ x_align = x_align
    $ y_align = y_align

    call screen qte_simple
    # can change to call screen qte_button to switch to button mode

    $ cont = _return
    # 1 if key was hit in time, 0 if key not

    return

############################################
#SCREEN
############################################
screen qte_simple:
    #key input qte

    timer interval repeat True action If(time_start > 0.0, true=SetVariable('time_start', time_start - interval), false=[Return(0), Hide('qte_simple')])
    # timer, using variables from label qte_setup
    # false is the condition if the timer runs out - and this will be reached if the user doesn't get hit the key on time

    key trigger_key action ( Return(1) )
    # the "key detector" (ends qte_event by returning 1)

    vbox:
        xalign x_align
        yalign y_align
        spacing 25
        # vbox arrangement

        text trigger_key:
            xalign 0.5
            color "#fff"
            size 36
            #outlines [ (2,"#000000",0,0) ]
            # text showing the key to press

        bar:
            value time_start
            range time_max
            xalign 0.5
            xmaximum 300
            if time_start < (time_max * 0.25):
                left_bar "#f00"
                # this is the part that changes the colour to red if the time reaches less than 25%


#Sprite Position Terms

transform closeleft:
    xalign 0.38
    yalign 1.0

transform closeright:
    xalign 0.62
    yalign 1.0

transform slightleft:
    xalign 0.3
    yalign 1.0

transform slightright:
    xalign 0.7
    yalign 1.0

transform midleft:
    xalign 0.2
    yalign 1.0

transform midright:
    xalign 0.8
    yalign 1.0

transform left:
    xalign 0.1
    yalign 1.0

transform right:
    xalign 0.9
    yalign 1.0

transform extremeleft:
    xalign 0.0
    yalign 1.0

transform extremeright:
    xalign 1.0
    yalign 1.0

transform upper:
    xalign 0.8
    yalign 0.5
# The game starts here.

label start:
    play music 'music.mp3'
    #SCENE 1
    'This story starts off with our main character Doug. A few years ago he was an army veteran but nowadays he just wanders the streets.'
    scene alley with fade
    show doug5
    d 'Ugh I need to get some!'
    hide doug5
    #SCENE 2
    scene training with fade
    'A few years eariler'
    show doug4
    d 'YOU\’RE CRAZY IF YOU THINK YOU CAN BEAT ME!'
    'Block Soyans hits by pressing spacebar!'
    hide doug4
    show dougfight at slightleft
    $ cont = 0 #continue variable
    $ arr_keys = ["K_SPACE"] #list of keyboard inputs to be selected from. See https://www.pygame.org/docs/ref/key.html for more keys

    call qte_setup(0.5, 0.5, 0.01, renpy.random.choice(arr_keys), renpy.random.randint(1, 9) * 0.1, renpy.random.randint(1, 9) * 0.1)
    # "Function Call" - see label qte_setup for detail on "function"
    # in the above, I randomly select a key from a previously defined set of keys (arr_keys), and randomise the location

    $ counter = 0 #counter variable
    while cont == 1 and counter < 10: 
        call qte_setup(0.5, 0.5, 0.01, renpy.random.choice(arr_keys), renpy.random.randint(1, 9) * 0.1, renpy.random.randint(1, 9) * 0.1)
        $ counter = counter + 1 #increment/increase the counter each time. When it reaches 10, it will exit the loop
        # to repeat the qte events until it is missed

    if counter == 10: #if we reached 10 rounds without missing
        "Perfect Blocking!"
        hide dougfight

    else:
        "{b}GAME OVER{/b}"
        return

    hide doug4
    show dougfight at slightright
    s "YOU\’RE CRAZY IF YOU THINK I CAN\’T BEAT YOU"

    'Watch out for Soyan\'s next attack!'
    $ counter = 0 #counter variable
    while cont == 1 and counter < 1: 
        call qte_setup(0.5, 0.5, 0.01, renpy.random.choice(arr_keys), renpy.random.randint(1, 9) * 0.1, renpy.random.randint(1, 9) * 0.1)
        $ counter = counter + 1 #increment/increase the counter each time. When it reaches 10, it will exit the loop
        # to repeat the qte events until it is missed

    if counter == 1: #if we reached 10 rounds without missing
        hide dougfight
        scene training with fade
        show soyan1
        s"Good training today."
        s'I\'m excited to see what you\'ll be able to do on the field'
    else:
        "{b}GAME OVER{/b}"
        return
    #SCENE 3
    scene store with fade
    'A few years later'
    show drox1 at slightright
    do 'Your perscription will be $125.80..'
    hide drox1
    show dougcry at right
    d ' IT\’S GON UP A MILLION SINCE LAST TIME!'
    hide dougcry
    show drox1
    do 'Sorry, it\'s the times we\'re in....'
    hide drox1
    show doug3
    d 'Nevermind..... Thank you.'
    #SCENE 4
    scene alley with fade
    'Doug goes to find a dealer he heard about from a friend'
    show doug2
    d 'Hey... I heard you could hook me up..'
    hide doug2
    show patch2 at midright
    p'Oh yeah... with what?'
    hide patch2
    ### CHOICES
    menu:
        'Be Scared':
            show dougrunning
            d'Nevermind I didn\'t mean to bother you!'
            hide dougrunning
        'Ask for Drugs':
            show doug1 at upper
            d'The... good stuff.'
            hide doug1

            show patch2 at midright
            p'I can\'t help you kid… now go!'
            hide patch2 
    #SCENE 5
    scene alley with fade
    show doug5
    d 'Ugh I need something to stop this pain.'
    hide doug5
    'Doug starts to walk around to look for a potential dealer and sees a paper on the ground.'
    d 'Expressmed... whats this?' 
    scene expressmed
    'I wonder if this is worth a try.'
    scene alley
    ### CLICK SIGN UP SCREEN
    ### CHOICES
    menu:
    ### NOT ACCPTED  DOUG - “MAN… I DIDN’T QUALIFY. WHAT WILL I DO..?”
        'Don\'t check it out':
            show doug5
            'Doug sits waiting for something to happen'
            d'Man forget that stupid website it\'s probably just a scam.'
            d'I\'d rather just find another dealer'
    ### ACCPTED DOUG - “SICK! THAT WAS EASY!!!”
        'Check it out':
            show phone
            'Doug checks out the website on his phone'
            hide phone
            show phone3 with fade
            d'SICK! THAT WAS EASY!!!'
    hide doug5
    hide phone3
    stop music fadeout 1.0
    scene p1
    ''
    scene p2
    ''
    scene p3
    ''
    return
